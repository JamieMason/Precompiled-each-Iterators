<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>pEach JavaScript Web Performance Optimization, loop unrolling, Duff's Device</title>
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="peach.css" type="text/css">
  <link rel="stylesheet" href="google-code-prettify/prettify.css" type="text/css">
</head>
<body onload="prettyPrint()">
  <div class="container">
    <header>
      <h1>Optimizing JavaScript loops with pEach</h1>

      <p class="lead">
        Loop unwinding, also known as loop unrolling, is a loop transformation technique that attempts to optimize a program's execution speed at the expense of its filesize. The transformation can be undertaken manually by the programmer, or by an optimizing compiler such as <a href="https://github.com/JamieMason/Precompiled-each-Iterators"><strong>pEach</strong></a>.
      </p>
    </header>
<div class="hero-unit">


    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span6">
          <h2>Before</h2>
          <pre class="prettyprint linenums">
function double(array) {
  for (var i = 0; i < array.length; i++) {
    array[i] = array[i] * 2;
  }
}</pre>
        </div>
        <div class="span6">
          <h2>After</h2>
          <pre class="prettyprint linenums">
var double = pEach(function (num, i, array) {
  array[i] = array[i] * 2;
});</pre>
        </div>
      </div>
    </div>
</div>



    <ol>
      <li>
        <p><code>for</code> loops are well known, easy to read, suit many scenarios, and are subsequently very popular.</p>
        <pre class="prettyprint linenums">
for (var i = 0; i < lolz.length; i++) {
  console.log("Remember ", lolz[i], "? I laughed so hard I had to change my shorts!");
}</pre>

      </li>
      <li>
        <p>In many cases other loop constructs run faster, but are often weird and hard to read.</p>
        <pre class="prettyprint linenums">
// Don't do this
var result = 0,
    i = prematureOptimisations.length - 1;

for (; i >= 0; i--) {
  console.log("Let's forget that ", prematureOptimisations[i], " ever happened");
}</pre>
      </li>
      <li>
        <p>Maintainable code is probably more important to your team than fast code.</p>
        <pre class="prettyprint linenums">
// @FIXME: Dave WTF?!! Rob xx
for (; i >= 0; i--) {</pre>
      </li>
      <li>
        <p>Methods like <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/forEach">Array.forEach</a> and <a href="http://documentcloud.github.com/underscore/#each">_.each</a> centralise and encapsulate our iteration code, saving us from writing loops at all.</p>
        <pre class="prettyprint linenums">
_.each(array, function(value) {
  console.log(value, " is so much easier to read");
});</pre>
      </li>
      <li>
        <p>Encapsulating our loops like this is a great opportunity to have highly optimised code, which is also stable and maintainable.</p>
      </li>
    </ol>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span6">
          <h2>Before</h2>
          <pre class="prettyprint linenums">
function double(array) {
  for (var i = 0; i < array.length; i++) {
    array[i] = array[i] * 2;
  }
}</pre>
        </div>
        <div class="span6">
          <h2>After</h2>
          <pre class="prettyprint linenums">
var double = pEach(function (num, i, array) {
  array[i] = array[i] * 2;
});</pre>
        </div>
      </div>
    </div>

  </div>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.1/underscore-min.js"></script>
  <script src="google-code-prettify/prettify.js"></script>
</body>
</html>
